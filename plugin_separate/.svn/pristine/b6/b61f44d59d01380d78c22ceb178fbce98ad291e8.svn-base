package com.hajduczek.xmleditor.utils;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class SchemaFinder {
	public static String findSchema(String xml) {
		String result = "";
		
		if (xml != null) {
			if (xml.contains("noNamespaceSchemaLocation=")) {
				String[] splitedDoc = xml.split("noNamespaceSchemaLocation=\"");
				splitedDoc = splitedDoc[1].split("\"");
				String schemaFileName = splitedDoc[0];
				result = getSchemaFileContent(schemaFileName);
			} else if ((xml.contains("<!DOCTYPE") || xml.contains("<! DOCTYPE"))
					&& xml.contains(".dtd")) {
				String[] splitedDoc = xml.split(" ");
				if (splitedDoc != null) {
					for (String s : splitedDoc) {
						if (s.contains(".dtd")) {
							String schemaFileName = s.replaceAll("\"", "");
							schemaFileName = schemaFileName.split(">")[0];
							result = getSchemaFileContent(schemaFileName);
							break;
						}
					}
				}
			} else {
				result = "No schema find.";
			}
		}

		return result;
	}

	private static String getSchemaFileContent(String fileName) {
		StringBuilder schema = new StringBuilder();

		try {
			BufferedReader in = new BufferedReader(new FileReader("C:\\Users\\hajdi\\workspace_czysty\\plugin_separate\\dtd\\"+fileName));
			String strLine;
			while ((strLine = in.readLine()) != null) {
				schema.append(strLine+"\n");
			}
		} catch (IOException e) {
			e.printStackTrace();
		}

		return schema.toString();
	}

	public static void main(String[] args) {
		String xml = "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>"
				+ "<shiporder orderid=\"889923\" "
				+ "xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance "
				+ "xsi:noNamespaceSchemaLocation=\"shiporder.xsd\">"
				+ "<orderperson>John Smith</orderperson>" + "<shipto>"
				+ "<name>Ola Nordmann</name>" + "<address>Langgt 23</address>"
				+ "<city>4000 Stavanger</city>" + "<country>Norway</country>"
				+ "</shipto>" + "<item>" + "<title>Empire Burlesque</title>"
				+ "<note>Special Edition</note>" + "<quantity>1</quantity>"
				+ "<price>10.90</price>" + "</item>" + "<item>"
				+ "<title>Hide your heart</title>" + "<quantity>1</quantity>"
				+ "<price>9.90</price>" + "</item>" + "</shiporder> ";

		findSchema(xml);

		String xml2 = "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>"
				+ "<!DOCTYPE note SYSTEM \"Note.dtd\">"
				+ "<note><to>Tove</to><from>Jani</from><heading>Reminder</heading><body>Don't forget me this weekend!</body></note>";

		findSchema(xml2);
	}
}
